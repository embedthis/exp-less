/*
    exp.json - Configuration for exp-less

    Transform by prefixing and minifying.
 */
{
    control: {
        transforms: {
            name:   'compile-less',
            from:   'less',
            to:     'css',
            script: `
                function transform(contents, meta, service) {
                    let recess = Cmd.locate('recess')
                    if (recess) {
                        let results = runFile(recess + ' -compile', contents, meta)
                        if (results == '') {
                            /* Failed, run again to get diagnostics - Ugh! */
                            let errors = runFile(recess, contents, meta)
                            throw 'Failed to parse less sheet ' + meta.file + '\n' + errors + '\n'
                        }
                        contents = results
                    } else {
                        trace('Warn', 'Cannot find recess')
                    }
                    return contents
                }
            `
        }
    }
}
